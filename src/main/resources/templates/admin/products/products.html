<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Products Management - AuroraDecors</title>
	<script src="https://cdn.tailwindcss.com"></script>
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>

<body class="bg-gray-100">
	<div class="flex h-screen">

		<div th:replace="~{nav/adminSidebar :: adminSidebar}"></div>

		<!-- Main Content -->
		<main class="flex-1 overflow-x-hidden overflow-y-auto">

			<div th:replace="~{nav/adminNavbar :: adminNavbar}"></div>

			<!-- Products Content -->
			<div class="p-6">
				<!-- Actions Bar -->
				<div class="flex justify-between items-center mb-6">
					<div class="flex items-center space-x-4">
						<form method="get" action="/admin/products" class="flex items-center space-x-4">
							<div class="relative">
								<input type="text" name="search" placeholder="Search products..." th:value="${param.search}"
									class="pl-10 pr-4 py-2 border rounded-lg focus:outline-none focus:border-purple-500">
								<i class="fas fa-search absolute left-3 top-3 text-gray-400"></i>
							</div>
							<select name="category" class="border rounded-lg px-4 py-2 focus:outline-none focus:border-purple-500">
								<option value="">All Categories</option>
								<option th:each="c : ${categories}" th:value="${c}" th:text="${c}" th:selected="${param.category == c}"></option>
							</select>
							<button type="submit" class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700">
								<i class="fas fa-search mr-2"></i>Search
							</button>
						</form>
					</div>
					<a href="/admin/products/create" class="bg-purple-600 text-white px-4 py-2 rounded-lg hover:bg-purple-700">
						<i class="fas fa-plus mr-2"></i>Add New Product
					</a>
				</div>

				<!-- Products Table -->
				<div class="bg-white rounded-lg shadow-sm">
					<div class="overflow-x-auto">
						<table class="w-full">
							<thead class="bg-gray-50">
								<tr>
									<th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">ID</th>
									<th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Image
									</th>
									<th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Name
									</th>
									<th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Category
									</th>
									<th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Price
									</th>
									<th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Stock
									</th>
									<th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Actions
									</th>
								</tr>
							</thead>
							<tbody class="divide-y divide-gray-200">
								<tr th:each="product : ${products}">
									<td class="px-6 py-4 whitespace-nowrap" th:text="${product.id}">1</td>
									<td>
										<div class="relative" style="width: 50px; height: 50px;">
											<img th:if="${product.imageUrl != null and !product.imageUrl.isEmpty() and product.imageUrl != 'null'}"
												th:src="${product.imageUrl}" 
												class="rounded w-full h-full object-cover"
												alt="Product"
												onerror="this.style.display='none'; this.parentElement.querySelector('.fallback-icon').style.display='flex';">
											<div th:if="${product.imageUrl == null or product.imageUrl.isEmpty() or product.imageUrl == 'null'}"
												class="rounded flex items-center justify-center bg-gray-100 fallback-icon w-full h-full">
												<i class="fas fa-image text-gray-400 text-sm"></i>
											</div>
											<div class="hidden rounded flex items-center justify-center bg-gray-100 fallback-icon w-full h-full">
												<i class="fas fa-image text-gray-400 text-sm"></i>
											</div>
										</div>
									</td>
									<td class="px-6 py-4 whitespace-nowrap" th:text="${product.name}">T-shirt</td>
									<td class="px-6 py-4 whitespace-nowrap" th:text="${product.category}">Clothing</td>
									<td class="px-6 py-4 whitespace-nowrap">Rs <span
										th:text="${product.price}">29.99</span></td>
									<td class="px-6 py-4 whitespace-nowrap" th:text="${product.stockQuantity}">150</td>
									<td class="px-6 py-4 whitespace-nowrap">
										<div class="flex space-x-2">
											<a th:href="@{/admin/products/{id}(id=${product.id})}" class="text-blue-600 hover:text-blue-800">
												<i class="fas fa-eye"></i>
											</a>
											<a th:href="@{/admin/products/{id}/edit(id=${product.id})}" class="text-green-600 hover:text-green-800">
												<i class="fas fa-edit"></i>
											</a>
											<form th:action="@{/admin/products/{id}/delete(id=${product.id})}" method="POST" 
												  onsubmit="return confirm('Are you sure you want to delete this product?')" class="inline">
												<button type="submit" class="text-red-600 hover:text-red-800">
													<i class="fas fa-trash"></i>
												</button>
											</form>
										</div>
									</td>
								</tr>
							</tbody>
						</table>
					</div>

					<!-- Pagination -->
					<div class="px-6 py-4 flex items-center justify-between border-t">
						<div class="text-sm text-gray-500">
							Showing <span th:text="${productPage.numberOfElements}">10</span> of <span th:text="${productPage.totalElements}">100</span> entries
						</div>
						<div class="flex space-x-2" th:if="${productPage.totalPages > 1}">
							<!-- Previous -->
							<a th:href="@{/admin/products(
									page=${productPage.number - 1},
									size=${productPage.size},
									search=${param.search},
									category=${param.category})}"
							   th:class="'px-3 py-1 border rounded ' + (${productPage.first} ? 'text-gray-400 cursor-not-allowed pointer-events-none' : 'hover:bg-gray-50')">
								Previous
							</a>
							<!-- Page Numbers -->
							<a th:each="pageNum : ${#numbers.sequence(T(java.lang.Math).max(0, productPage.number - 2), T(java.lang.Math).min(productPage.totalPages - 1, productPage.number + 2))}"
							   th:href="@{/admin/products(
									page=${pageNum},
									size=${productPage.size},
									search=${param.search},
									category=${param.category})}"
							   th:class="'px-3 py-1 border rounded ' + (${pageNum == productPage.number} ? 'bg-purple-600 text-white' : 'hover:bg-gray-50')"
							   th:text="${pageNum + 1}">
							</a>
							<!-- Next -->
							<a th:href="@{/admin/products(
									page=${productPage.number + 1},
									size=${productPage.size},
									search=${param.search},
									category=${param.category})}"
							   th:class="'px-3 py-1 border rounded ' + (${productPage.last} ? 'text-gray-400 cursor-not-allowed pointer-events-none' : 'hover:bg-gray-50')">
								Next
							</a>
						</div>
					</div>
				</div>
			</div>
		</main>

	</div>
</body>
</html>